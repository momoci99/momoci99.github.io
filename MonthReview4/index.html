<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>4월 회고 - YKMO 기술 메모</title>
<meta name="description" content="4월 회고  한번 회고가 밀리기 시작하니 답도 없이 밀려버려 결국 한달 회고를 작성하게 되었다. (맙소사!)">


  <meta name="author" content="MO YEONG-KWON">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="YKMO 기술 메모">
<meta property="og:title" content="4월 회고">
<meta property="og:url" content="https://momoci99.github.io//MonthReview4/">


  <meta property="og:description" content="4월 회고  한번 회고가 밀리기 시작하니 답도 없이 밀려버려 결국 한달 회고를 작성하게 되었다. (맙소사!)">







  <meta property="article:published_time" content="2019-04-28T00:00:00+00:00">





  

  


<link rel="canonical" href="https://momoci99.github.io//MonthReview4/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "MO YEONG-KWON",
      "url": "https://momoci99.github.io//"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="YKMO 기술 메모 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          YKMO 기술 메모
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://github.com/momoci99" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">MO YEONG-KWON</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>나를 쥐어짜는 즐거움</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Seoul, South Korea</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/momoci99" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      
        <li>
          <a href="mailto:momoci99@gmail.com">
            <meta itemprop="email" content="momoci99@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="4월 회고">
    <meta itemprop="description" content="4월 회고  한번 회고가 밀리기 시작하니 답도 없이 밀려버려 결국 한달 회고를 작성하게 되었다. (맙소사!)">
    <meta itemprop="datePublished" content="April 28, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">4월 회고
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="4월-회고">4월 회고</h1>
<ul>
  <li>한번 회고가 밀리기 시작하니 답도 없이 밀려버려 결국 한달 회고를 작성하게 되었다. <em>(맙소사!)</em></li>
</ul>

<h2 id="이번달에-있었던-일">이번달에 있었던 일</h2>

<ol>
  <li>
    <p>DB 메모리 이슈 해결</p>
  </li>
  <li>
    <p>React 개인 프로젝트</p>
  </li>
  <li>
    <p>ML 강의</p>
  </li>
  <li>
    <p>뒤돌아보는 시간</p>
  </li>
</ol>

<hr />

<h2 id="1-db-메모리-이슈-해결">1. DB 메모리 이슈 해결</h2>

<p>거진 한달을 괴롭혔던 메모리 이슈를 해결하는데 성공하였다. 일단 해결한 이후부터 동일한 문제는 발생하지 않지만 계속 데이터가 쌓여가면 문제가 발생할 가능성이 있어 차후에 테이블 구조를 개선하기로 하였다. 메모리 이슈를 해결하기 전까지의 상황을 정리하면 이렇다.</p>

<ul>
  <li>유저가 몰리는 시간대에 급격한 DB 반응성 저하.</li>
  <li>조사결과 메모리 락이 발생하고 있음.</li>
  <li>이 메모리 락때문에 전체 시스템의 반응성이 저하되는 문제가 발생함.</li>
</ul>

<p>여기까지가 이전까지의 상황이였다. 그럼 문제는 무엇인가?</p>

<blockquote>
  <p>도대체 어떤 쿼리가 얼마만큼의 메모리를 점유하는가?</p>
</blockquote>

<p>이걸 당최 알수가 없어서 근 한달동안 어찌할 도리가 없었다. 이전의 해결 과정에서 문서 목록 조회 쿼리가 문제라고 판단하여 튜닝을 진행했지만 별 소득이 없었다. 헛다리 짚은것이였다. 그렇게 삽질과 구글링을 거치다보니 결국 해외 사이트에서 해답을 찾을 수 있었다.</p>

<p><a href="https://www.mssqltips.com/sqlservertip/2827/troubleshooting-sql-server-resourcesemaphore-waittype-memory-issues/">Troubleshooting SQL Server RESOURCE_SEMAPHORE Waittype Memory Issues</a></p>

<h3 id="해결과정">해결과정</h3>

<p>1) 리소스 대기중인 프로세스 확인</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">SYSPROCESSES</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">lastwaittype</span>
</code></pre></div></div>

<p>이 쿼리의 결과로 몇개의 프로세스가 리소스 대기중인지 알 수 있다. DB 메모리 이슈가 발생한 상태에서 이 쿼리를 실행하면 수많은 쿼리들이 <code class="language-plaintext highlighter-rouge">RESOURCE_SEMAPHORE</code> 상태임을 알 수 있었다.</p>

<p>2) 메모리가 부여된 쿼리와 아직 부여되지 않은 쿼리 수를 확인</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_query_resource_semaphore</span>
</code></pre></div></div>

<p>3) 메모리를 할당받기 위해 대기열에서 대기중인 모든 쿼리의 세부정보 조회</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_query_memory_grants</span>
</code></pre></div></div>
<p>이 쿼리를 통해 현재 메모리를 할당받기위해 대기중인 쿼리에 대한 정보를 파악할 수 있었다. 이 쿼리가 나타내는 정보는 <a href="https://docs.microsoft.com/ko-kr/sql/relational-databases/system-dynamic-management-views/sys-dm-exec-query-memory-grants-transact-sql?view=sql-server-2017">sys.dm_exec_query_memory_grants</a>링크에 상세히 나타나 있으며 내가 주목한 부분은 <code class="language-plaintext highlighter-rouge">grant_time</code> 과 <code class="language-plaintext highlighter-rouge">requested_memory_kb</code> 였다. 이 항목은 각각 쿼리에 메모리가 부여된 시각 / 요청된 총 메모리 양이며 아직 메모리가 부여되지 않은경우 NULL이 된다. 메모리 이슈가 발생한 상태에서 이 쿼리를 실행했더니 <code class="language-plaintext highlighter-rouge">requested_memory_kb</code>가 2GB에 가까운 쿼리들이 메모리를 할당받기위해 대기하고 있었던 것이였다. 도대체 어떤 쿼리가 2GB씩이나 요청하고 있는것인가.</p>

<p>4) 대기중인 쿼리의 핸들값을 통해 실제 쿼리 실행문 알아내기</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">sys</span><span class="p">.</span><span class="n">dm_exec_sql_text</span><span class="p">(</span><span class="n">sql_handle</span><span class="p">)</span>
</code></pre></div></div>

<p>3)에서 실행한 결과값 중 <code class="language-plaintext highlighter-rouge">sql_handle</code>이 함께 나오는데 이 값을 가지고 위 쿼리를 실행하면 실제 쿼리의 텍스트가 나오게 된다.</p>

<p>5) 쿼리 분석</p>

<p>실제 쿼리를 분석한 결과 문서 조회 쿼리가 중첩되어 실행 대기중이었다는것을 알 수 있었다. 추측이지만 옵티마이저가 병렬처리를 위해 쿼리를 묶어버린게 아닌가 생각된다.</p>

<p>6) 정리</p>

<ul>
  <li>동시에 너무 많은 쿼리를 실행하려고 하는 바람에 엄청난 메모리할당을 요청하였고 DB에 부여된 시스템 메모리는 고작해야 16GB였으므로 저 쿼리가 여러번 요청되면 메모리 할당을 위해 리소스 락이 걸린 것이였다.</li>
</ul>

<p>7) 해결</p>

<ul>
  <li>DB의 병렬처리 수준을 조절하는것으로 해결하였다.</li>
</ul>

<p>이 메모리 이슈를 해결하기위해 한달을 넘게 삽질을 하고 우리팀 특히 팀장님이 고생을 많이 하셨다. 문제가 재현이 잘 안되고 분석이 어려워 이때까지 겪은 이슈중 가장 머리아픈 이슈 Best 3안에 들어가고도 남을것이다. 이번 문제 해결을 통해 얻은것은 모든 문제에는 원인이 있고 구글링을 잘하면 대부분 해결된다는것이였다. 이전까지는 언제 어떻게 이 문제가 발생하는지에 대해 검색했다면 이번에는 메모리 사용 중심으로 검색을 하여 위의 해답을 찾은것이였다. 결론은? 침착한 디버깅과 검색능력이 중요한것같다. (이 문서 조회의 쿼리 튜닝은 또 별개의 문제이니 다음에 또 이야기 하겠다.)</p>

<h2 id="2-react-개인-프로젝트">2. React 개인 프로젝트</h2>

<ul>
  <li><a href="https://github.com/momoci99/movie_app">github 프로젝트 링크</a></li>
  <li><a href="https://momoci99.github.io/movie_app/">만들어진 gitPage</a></li>
</ul>

<p>작년부터 틈틈히 React 관련 공부(?)를 진행했지만 그리 순탄히 진행되지 않았고 결국 인프런의 노마드코더스가 올린 react관련 동영상 강의를 보게 되었다. 클론 코딩이라는 방식으로 강의가 진행되었는데 이게 나와 잘맞았는지 책으로 보는것보다 이게 훨씬 이해가 잘되었다. React가 왜 생겼는지, 어떤 방식으로 동작하는지를 말이다. 무튼 영화 목록을 가지고 오는 API를 이용하여 간단한 영화 목록 조회 페이지를 만들게 되었다.</p>

<p>그런데 이거 만들다보니 재미가 생겨서 좀더 개선해서 토이 프로젝트로 하나 진행하려고 한다. 시간이 얼마나 날지 모르겠지만 퇴근하고 나서 틈틈히 놀아볼 생각이다.</p>

<h2 id="3-ml-강의">3. ML 강의</h2>

<p>React와 더불어 최근 듣고 있는 머신러닝 관련 강의가 있다. <a href="https://developers.google.com/machine-learning/crash-course/ml-intro?hl=ko">링크</a></p>

<p>같은 팀의 선배가 추천해준 구글에서 진행하는 강의인데 통계를 가지고 머신러닝 강의를 진행해 나가고 있다. 시작한지는 2주정도 되었는데, 이거 정말 어렵다. 그러나 재미있으니 어떻게든 해나가야겠다.</p>

<h2 id="4-잡소리">4. 잡소리</h2>

<p>내일(시간상 오늘이지만) 출근해야하는데 큰일났다.. 헣.. 무튼, 요즘들어 이직욕구가 폭발하고 있다. 지금 다니고 있는회사에 처음 들어올때는 솔루션 회사인줄 알았는데 3년차 개발자(현재 2년 1개월 근무)가 될때까지 SI만 죽어라 한것같다. 물론 내가 있는 부서가 그나마 적자 안내고 잘 해나가고 있다는것은 함정이긴 하지만..</p>

<p>아무튼간에 발주사의 갑질(특히 요구사항이 숨쉬듯 바뀌는것과 기한을 멋대로 바꾸는것), 발주사 직원의 막말, 그리고 최신 기술 스택과는 거리가 너무 먼 폐쇄망 개발 환경 등에 진절머리가 나고 있다.(SI 업계에 오래 계신분들 정말 진심으로 존경합니다.) 정말 화가 나는건 내 능력의 부족이다. React 관련 개발업무를 하고싶지만 React에 대해 잘 모르니 할수가 없다. 그러니 공부하고있는것이지만 퇴근하고나서 항상 딴짓하기 바쁘니 미칠 지경이다. 더이상 발주사에 갑질 당하지 않고 행복한 개발자가 되기위해 노력해야지..</p>

<p>힘내자.</p>

        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-04-28T00:00:00+00:00">April 28, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=4%EC%9B%94+%ED%9A%8C%EA%B3%A0%20https%3A%2F%2Fmomoci99.github.io%2F%2FMonthReview4%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmomoci99.github.io%2F%2FMonthReview4%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmomoci99.github.io%2F%2FMonthReview4%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/WeekReview3-2/" class="pagination--pager" title="3주 회고(3/4~3/23)
">Previous</a>
    
    
      <a href="/NoneDateReview/" class="pagination--pager" title="비정기 회고
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ProjectFinishedRetrospect/" rel="permalink">프로젝트 마무리 회고
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">3개월 전 즈음, 진행하던 webrtc 관련 프로젝트가 다른 부서로 넘어가고 저는 신규 서비스를 개발하는 프로젝트에 참여하게 되었습니다. threejs와 react를 활용한 웹 기반 3d 컨텐츠 제작 및 증강 서비스 개발 업무에 참여하면서 팀, 기술 스택, 업무 방식이 바뀌었고, ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ThreejsDailyLog/" rel="permalink">React에서 threejs 사용 및 삽질
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">React + Typescript 환경에서 Threejs 사용시 활용했던 라이브러리 및 삽질했던 내용들을 간단하게 정리하였습니다.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021YearRetrospect/" rel="permalink">2021년 회고
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">순식간에 지나간 2021년이 끝나갑니다. 한해를 돌아보는 회고를 써 봅니다.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/BookReviewSystemDesignChapter2/" rel="permalink">Book review - 가상 면접 사례로 배우는 대규모 시스템 기초  (2장 개략적인 규모 추정)
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">2장 개략적인 규모 추정
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 MO YEONG-KWON. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154155002-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154155002-1', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://momoci99.github.io//MonthReview4/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/MonthReview4"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://momoci99.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
