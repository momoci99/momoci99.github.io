<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.17.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>3주 회고(3/4~3/23) - YKMO 기술 메모</title>
<meta name="description" content="3주 회고(2019-03-04~2019-03-23)">


  <meta name="author" content="MO YEONG-KWON">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="YKMO 기술 메모">
<meta property="og:title" content="3주 회고(3/4~3/23)">
<meta property="og:url" content="https://momoci99.github.io//WeekReview3-2/">


  <meta property="og:description" content="3주 회고(2019-03-04~2019-03-23)">







  <meta property="article:published_time" content="2019-03-24T00:00:00+00:00">





  

  


<link rel="canonical" href="https://momoci99.github.io//WeekReview3-2/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "MO YEONG-KWON",
      "url": "https://momoci99.github.io//"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="YKMO 기술 메모 Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          YKMO 기술 메모
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://github.com/momoci99" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">MO YEONG-KWON</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>나를 쥐어짜는 즐거움</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Seoul, South Korea</span>
        </li>
      

      
        
          
        
          
        
          
        
          
        
          
            <li><a href="https://github.com/momoci99" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
        
      

      

      
        <li>
          <a href="mailto:momoci99@gmail.com">
            <meta itemprop="email" content="momoci99@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="3주 회고(3/4~3/23)">
    <meta itemprop="description" content="3주 회고(2019-03-04~2019-03-23)">
    <meta itemprop="datePublished" content="March 24, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">3주 회고(3/4~3/23)
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="3주-회고2019-03-042019-03-23">3주 회고(2019-03-04~2019-03-23)</h1>

<ul>
  <li>늦은 회고</li>
  <li>EAI 구축</li>
  <li>VDI 환경 구축</li>
  <li>DB 메모리 락</li>
</ul>

<h2 id="늦은-회고">늦은 회고</h2>

<p>급작스러운 경주 출장으로 인하여 회고가 무려 3주치가 밀리게 되었다.</p>

<h2 id="1-eai-코드-신규-작성">1. EAI 코드 신규 작성</h2>

<p>갑자기 고객사쪽에서 EAI 고도화 사업을 추진한다고 EAI 인터페이스가 모조리 바뀐다는 소식이 본사로 날아들었다. 이게 왜 큰일인가하면..</p>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Enterprise_application_integration">EAI 정의 - 영문위키</a></li>
</ul>

<p>고객사쪽은 대략적으로 아래와 같은 구조를 가지고 있으며</p>

<p>SAP DB &lt;-&gt; RFC Function &lt;-&gt; EAI Server &lt;-&gt; 협력사 시스템</p>

<p>협력사 시스템에서는 EAI Server를 향해 사전 정의된 파라미터를 통해 URL로 호출하고 데이터를 받거나 전달하는 구조를 가지고 있다. 그런데 EAI Server의 인터페이스가  바뀌게 된다면 협력사 시스템에서 EAI Server를 호출하는 코드가 어찌되던간에 바뀐다는 이야기였다.</p>

<p>문제는 대부분의 협력사 시스템은 SAP DB에서 데이터를 참조하는게 대부분이며 여기에 접근하기 위한 EAI Server에 굉장히 의존적이라 EAI Server에 조금이라도 장애가 발생하면 아무리 협력사에서 대비한다한들 반드시 영향을 받게되는것이다. 하물며 인터페이스가 바뀌는데 그 영향은 이루 말할 필요도 없을것이다. EAI Server와 통신하는 코드를 다 뜯어고쳐하는것이다. 만약 고치지 못한다면?? 그날로 서비스 종료다.</p>

<p>무튼 이러한 이유로 본사에서 나를 긴급하게 경주로 보내게 되었다. 사태 파악과 코드 변경을 위해서였다. 빠르게 경주에 도착하여 한전 KDN쪽에서 제공하는 EAI Server와 통신을 위한 java 라이브러리 코드를 제공받았다.</p>

<p>파악결과 아래와 같은점이 변경되었다.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Broker</code> 기반에서 <code class="language-plaintext highlighter-rouge">IData</code> (<a href="http://grandyop94.free.fr/wMe/7.1.2/7-1-1_Integration_Server_Java_API_Reference/com/wm/data/package-summary.html">참고 링크</a>) 기반으로 변경</p>
  </li>
  <li>
    <p>일관적인 인터페이스명 -&gt; 접근하는 SAP 모듈에 따라 분류되어 새로운 명칭 부여</p>
    <ul>
      <li>ex : PM 모듈이면 PM.XXXX</li>
    </ul>
  </li>
</ul>

<p>변경사항은 파악되었고 이제 작업을 할 시간이다. 이번에 중점을 둔 사항은 아래와 같았다.</p>

<p>1) <strong>기존 백엔드 코드의 변경 최소화</strong> : 당연한 이야기지만 백엔드 코드를 건드리게되면 겉잡을 수 없는 변경점이 발생하게 될것이다. (그리고 나는 디버깅 지옥에 빠지겠지)</p>

<p>2) <strong>코드 가독성 확보</strong> : 입사한 이래로 현 시스템과 EAI Server와 통신하는 코드는 한 페이지에 만줄이 넘어가는 라인이 다 들어가 있어서 디버깅이나 코드 수정이 너무 어려웠다.</p>

<p>3) <strong>더이상 사용되지 않는 함수 삭제</strong> : 개발이 진행되면서 더이상 사용되지 않는 코드들도 많아 정리가 필요하다.</p>

<p>라이브러리를 분석하고나니 그렇게 어려운 부분은 없었다. IData를 탐색하는 재귀함수를 작성하여 데이터를 리턴하게 하였고 호출 인터페이스 함수마다 별도의 클래스로 따로 코드를 분할하여 가독성을 향상시켰다. 다른부분은 몰라도 가독성을 향상시킨 부분만큼은 지금 생각해도 뿌듯하다. 그 외에 더이상 사용되지 않던 코드들도 이번 기회에 정리하였다.</p>

<h2 id="2-vdi-환경-구축">2. VDI 환경 구축</h2>

<p>사실 1번과 연계되는 사항인데.. 한참 EAI 코드 수정중에 현재 근무하고 있는 사무실의 PC를 모조리 교체하고 VDI 환경으로 바꾼다는것이다. 뭐 어쩌랴.. 을의 슬픈 현실이다. 바꾼다는데 별 도리가 없다. 만약 VDI 환경으로 바뀌게 되면 해당계정과 방화벽을 모두 새로 신청해야하는것이다. 물론 업무환경 + 개발환경을 다시 구축해야하는건 덤이다.</p>

<p>결국 1주일동안 아무것도 못하고 VDI환경 구축에 매달렸다. EAI는 코드는 다 만들었으나 EAI Server(개발) 과의 통신 테스트는 절반정도밖에 진행하지 못했다.</p>

<h2 id="3-db-메모리-락">3. DB 메모리 락</h2>

<p>지난달부터 괴롭혀온 데이터베이스의 쿼리 리턴이 엄청나게 느려진 원인을 파악할 수 있었다.</p>

<p>DB를 차근히 모니터링한 결과 대기중인 태스크가 순간적으로 폭증하여 평소에 거의 0에 가깝던 수치가 2000000 까지 상승하는것을 확인 할 수 있었다. 그럼 왜 대기중인 태스크의 수치가 폭발하고 있는것인가? 원인을 찾기위해 구글링중 이곳을 참조하여 찾을 수 있었다.
<a href="https://docs.microsoft.com/ko-kr/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql?view=sql-server-2017]">sys.dm_os_waiting_tasks</a></p>

<p>이 쿼리를 실행하니 아래의 항목이 엄청난 대기시간을 가지고 있는것을 확인하였다.</p>

<p><code class="language-plaintext highlighter-rouge">RESOURCE_SEMAPHORE</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>다른 동시 쿼리로 인해 쿼리 메모리 요청을 즉시 허용할 수 없는 경우에 발생합니다. 대기 수가 많고 대기 시간이 길면 동시 쿼리 수 또는 메모리 요청 양이 과도하게 많은 것입니다.
</code></pre></div></div>

<p>그러니까 메모리가 부족하거나 메모리를 너무 많이 사용하고 있는것이라고 볼 수 있다.</p>

<p>이때까지 쌓인 정보로 추측하건데, SAP에서 자료를 동기화하는 과정에서 시스템 자체적으로 관리하는 버전이 너무 많이 쌓이게 되었으며, Partition By를 통해 데이터를 가지고 오는과정에서 메모리의 과다점유 현상이 발생한것이라고 보인다.</p>

<p>그래서 우리팀 개발자들과 머리를 맞대어 논의한 결과(물론 텔레그램으로) DB에 쌓인 쓸모없는 버전 데이터를 지우자고 결론이 났다. 물론 이걸 지우는작업은 또 다른 고민을 낳게 되어 사람 환장하게 만들게 되는데 이 이야기는 다음에 하기로 하겠다.</p>

<p>참조 <a href="http://www.dbguide.net/db.db?cmd=view&amp;boardUid=13767&amp;boardConfigUid=9&amp;boardIdx=66&amp;boardStep=1">DB 가이드</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-03-24T00:00:00+00:00">March 24, 2019</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=3%EC%A3%BC+%ED%9A%8C%EA%B3%A0%283%2F4~3%2F23%29%20https%3A%2F%2Fmomoci99.github.io%2F%2FWeekReview3-2%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmomoci99.github.io%2F%2FWeekReview3-2%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmomoci99.github.io%2F%2FWeekReview3-2%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/WeekReview3-1/" class="pagination--pager" title="1주일 회고(2/25~3/03)
">Previous</a>
    
    
      <a href="/MonthReview4/" class="pagination--pager" title="4월 회고
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ProjectFinishedRetrospect/" rel="permalink">프로젝트 마무리 회고
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">3개월 전 즈음, 진행하던 webrtc 관련 프로젝트가 다른 부서로 넘어가고 저는 신규 서비스를 개발하는 프로젝트에 참여하게 되었습니다. threejs와 react를 활용한 웹 기반 3d 컨텐츠 제작 및 증강 서비스 개발 업무에 참여하면서 팀, 기술 스택, 업무 방식이 바뀌었고, ...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ThreejsDailyLog/" rel="permalink">React에서 threejs 사용 및 삽질
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">React + Typescript 환경에서 Threejs 사용시 활용했던 라이브러리 및 삽질했던 내용들을 간단하게 정리하였습니다.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021YearRetrospect/" rel="permalink">2021년 회고
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">순식간에 지나간 2021년이 끝나갑니다. 한해를 돌아보는 회고를 써 봅니다.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/BookReviewSystemDesignChapter2/" rel="permalink">Book review - 가상 면접 사례로 배우는 대규모 시스템 기초  (2장 개략적인 규모 추정)
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">2장 개략적인 규모 추정
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 MO YEONG-KWON. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>







  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154155002-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154155002-1', { 'anonymize_ip': false});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://momoci99.github.io//WeekReview3-2/";  // Replace PAGE_URL with your page's canonical URL variable
      this.page.identifier = "/WeekReview3-2"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
      var d = document, s = d.createElement('script');
      s.src = 'https://momoci99.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
